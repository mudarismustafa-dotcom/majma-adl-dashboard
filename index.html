<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>مجمع العدل السكني - لوحة الإدارة</title>
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#0b0f17" />
  <link rel="stylesheet" href="./styles.css" />
  <script src="./app.js" defer></script>
  <link rel="icon" href="./icon-192.png" />
</head>
<body>

  <!-- شاشة تسجيل الدخول -->
  <div class="loginBack hidden" id="loginBack">
    <div class="loginCard">
      <div class="loginBrand">
        <img src="./logo.svg" alt="logo" style="width:72px;height:72px;object-fit:contain">
        <h2 style="margin:8px 0 0">مجمع العدل السكني</h2>
        <div class="small dim">تسجيل الدخول</div>
      </div>
      <input id="loginUser" class="input" placeholder="اسم المستخدم" />
      <input id="loginPass" type="password" class="input" placeholder="كلمة المرور" style="margin-top:8px" />
      <button id="loginBtn" class="btn btn--primary" style="width:100%; margin-top:10px">دخول</button>
      <div class="small dim" style="margin-top:8px">الافتراضي: admin / @1000@</div>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <img class="brand__logo" src="./logo.svg" alt="شعار مجمع العدل السكني" />
      </div>

      <nav class="nav" id="nav">
        <button class="nav__item active" data-page="dashboard">الرئيسية</button>
        <button class="nav__item" data-page="units">الوحدات السكنية</button>
        <button class="nav__item" data-page="contractors">المقاولون</button>
        <button class="nav__item" data-page="engineers">المهندسون</button>
        <button class="nav__item" data-page="workers">العمال</button>
        <button class="nav__item" data-page="settings">الإعدادات</button>
      </nav>

      <div class="sidebar__footer">
        <div class="small">حالة السيرفر:</div>
        <div class="pill" id="apiStatus">غير متصل</div>
        <div class="small dim" id="apiBase"></div>
      </div>
    </aside>

    <main class="main">
      <header class="topbar">
        <div class="topbar__left">
          <h1 id="pageTitle">الرئيسية</h1>
          <div class="small dim">نظام كامل يحفظ بيانات فعلياً (Cloudflare Workers + D1)</div>
        </div>
        <div class="topbar__right">
          <button class="btn btn--ghost" id="seedBtn">توليد 500 وحدة</button>
        </div>
      </header>

      <section class="hero card">
        <div class="hero__media">
          <img src="./hero.png" alt="صورة واجهة" />
        </div>
        <div class="hero__text">
          <h2>إدارة مجمع العدل السكني</h2>
          <p class="dim">
            إدارة الوحدات (500)، تعيين المقاول والمهندس، العمال، ومراحل البناء (أرض/هيكل/كامل).
          </p>
          <div class="row">
            <div class="kpi">
              <div class="kpi__label">عدد الوحدات</div>
              <div class="kpi__value" id="kpiUnits">--</div>
            </div>
            <div class="kpi">
              <div class="kpi__label">قيد التنفيذ</div>
              <div class="kpi__value" id="kpiInProgress">--</div>
            </div>
            <div class="kpi">
              <div class="kpi__label">منجزة</div>
              <div class="kpi__value" id="kpiDone">--</div>
            </div>
            <div class="kpi">
              <div class="kpi__label">الرصيد</div>
              <div class="kpi__value" id="kpiBalance">--</div>
            </div>
          </div>
        </div>
      </section>

      <section class="card page" id="page-dashboard">
        <h2>لوحة مختصرة</h2>
        <div class="row">
          <div class="stat"><div class="stat__title">عدد الأصناف</div><div class="stat__value" id="statItems">--</div></div>
          <div class="stat"><div class="stat__title">إجمالي المشتريات</div><div class="stat__value" id="statPurchases">--</div></div>
          <div class="stat"><div class="stat__title">إجمالي المصروفات</div><div class="stat__value" id="statExpenses">--</div></div>
        </div>
        <p class="small dim">هذه نسخة أولى جاهزة للتوسع (مشتريات/محاسبة/مخزن كامل) حسب أولوياتك.</p>
      </section>

      <!-- الأقسام: سيتم بناؤها/تعبئتها من app.js -->
      <section class="card page hidden" id="page-units"></section>
      <section class="card page hidden" id="page-contractors"></section>
      <section class="card page hidden" id="page-engineers"></section>
      <section class="card page hidden" id="page-workers"></section>

      <section class="card page hidden" id="page-settings">
        <h2>الإعدادات</h2>
        <div class="small dim">إذا كان رابط الـ API مختلف (Workers)، ضعه هنا:</div>
        <div class="row">
          <input class="input" id="apiOverride" placeholder="https://majma-adl-api.xxx.workers.dev" />
          <button class="btn" id="saveApi">حفظ</button>
          <button class="btn btn--ghost" id="resetApi">إرجاع</button>
        </div>
      </section>

    </main>
  </div>

  <!-- ✅ المودال العام (مهم جداً لعمل الإضافة/التعديل بكل الأقسام) -->
  <div class="modalBack hidden" id="modalBack">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal__head">
        <div>
          <h2 id="modalTitle">—</h2>
          <div class="small dim" id="modalSub">—</div>
        </div>
        <button class="btn btn--ghost" id="modalClose">إغلاق</button>
      </div>

      <div class="card inner" style="margin-top:12px;">
        <div class="form" id="modalForm"></div>

        <div class="row" style="margin-top:12px; justify-content:flex-start;">
          <button class="btn btn--primary" id="modalSave">حفظ</button>
          <button class="btn badge--red" id="modalDelete" style="display:none">حذف</button>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
